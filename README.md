# Bç«™è§†é¢‘è§£ææ’ä»¶

é€‚ç”¨äº MaiBot çš„ Bç«™è§†é¢‘å†…å®¹è§£ææ’ä»¶ã€‚

---

## âš ï¸ å…è´£å£°æ˜

**æœ¬æ’ä»¶ä½¿ç”¨ Claude 4.5 å…¨é¢ç¼–å†™ã€‚**

ä½¿ç”¨æœ¬æ’ä»¶å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¡æ¬¾ï¼š

1. æœ¬æ’ä»¶æŒ‰"åŸæ ·"æä¾›ï¼Œä¸æä¾›ä»»ä½•å½¢å¼çš„æ˜ç¤ºæˆ–æš—ç¤ºæ‹…ä¿
2. ä½œè€…ä¸å¯¹å› ä½¿ç”¨æœ¬æ’ä»¶è€Œå¯¼è‡´çš„ä»»ä½•ç›´æ¥ã€é—´æ¥ã€å¶ç„¶ã€ç‰¹æ®Šæˆ–åæœæ€§æŸå®³æ‰¿æ‹…è´£ä»»
3. æœ¬æ’ä»¶ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’ŒBç«™ç”¨æˆ·åè®®
4. ç”¨æˆ·åº”è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨æœ¬æ’ä»¶çš„å…¨éƒ¨é£é™©

---

## âš ï¸ æ³¨æ„äº‹é¡¹

åœ¨ä½¿ç”¨æœ¬æ’ä»¶å‰ï¼Œè¯·**åŠ¡å¿…æ³¨æ„**ä»¥ä¸‹å‡ ç‚¹ï¼š

0.  é…ç½®æ–‡ä»¶æœ‰å¤šä¹…æ¸…ç†ä¸´æ—¶è§†é¢‘æ–‡ä»¶é€‰é¡¹ï¼Œä½†æ˜¯è¯·è®¾ç½®çš„é•¿ä¸€ç‚¹ï¼Œç„¶å**æ‰‹åŠ¨æ¸…ç†æ’ä»¶ç›®å½•ä¸‹çš„ `data/temp`**ï¼Œæˆ–è€…ä½ å¯ä»¥ç›¸ä¿¡aiå†™å‡ºæ¥çš„ä»£ç ã€‚

1. **å¿…é¡»å®‰è£…æ’ä»¶ä¾èµ–**ï¼šæœ¬æ’ä»¶éœ€è¦é¢å¤–çš„ Python ä¾èµ–åŒ…ï¼Œè¯·å‚è€ƒä¸‹æ–¹"å®‰è£…æ’ä»¶"ç« èŠ‚ã€‚
2. **ASRåŠŸèƒ½é…ç½®**ï¼šå¦‚éœ€ä½¿ç”¨ ASR åŠŸèƒ½ï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰ï¼Œå¿…é¡»åœ¨ MaiBot é…ç½®æ–‡ä»¶ `model_config.toml` ä¸­é…ç½® `[model_task_config.voice]` è¯­éŸ³è¯†åˆ«æ¨¡å‹ï¼Œå¦åˆ™ ASR åŠŸèƒ½æ— æ³•æ­£å¸¸è¿è¡Œã€‚
3. **FFmpeg åŠŸèƒ½è¯´æ˜**ï¼šFFmpeg æ˜¯æœ¬æ’ä»¶çš„æ ¸å¿ƒä¾èµ–ï¼Œè´Ÿè´£ä»¥ä¸‹åŠŸèƒ½ï¼š
   - è§†é¢‘ä¸‹è½½åçš„æ ¼å¼å¤„ç†
   - è§†é¢‘æŠ½å¸§ï¼ˆæå–å…³é”®å¸§ç”¨äºè§†è§‰åˆ†æï¼‰
   - éŸ³é¢‘åˆ†ç¦»ï¼ˆç”¨äº ASR è¯­éŸ³è¯†åˆ«ï¼‰
4. **SESSDATA** ï¼šä½¿ç”¨æ­¤åŠŸèƒ½è·å–è§†é¢‘å­—å¹•ï¼Œå¯èƒ½ä¼šå¯¼è‡´è´¦å·è¢«**bç«™é£æ§**ï¼Œè¯·ä½¿ç”¨å°å·ã€‚

---

## å®‰è£…å‰å‡†å¤‡

### å®‰è£… ffmpeg

- æœ¬æ’ä»¶éœ€è¦ç³»ç»Ÿå®‰è£… **ffmpeg** å·¥å…·ã€‚æ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿ PATH ä¸­çš„ ffmpegã€‚



---

## å®‰è£…æ’ä»¶

1. å°†æ•´ä¸ª `bilibili_video_parser` ç›®å½•å¤åˆ¶åˆ° MaiBot çš„ `plugins` ç›®å½•ä¸‹

2. **å®‰è£…æ’ä»¶ä¾èµ–**ï¼ˆå¿…é¡»åœ¨ MaiBot çš„è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œï¼‰ï¼š

   ```bash
   #### é¦–å…ˆè¿›å…¥ MaiBot çš„è™šæ‹Ÿç¯å¢ƒ
   # Windows:
   cd MaiBotç›®å½•
   .venv\Scripts\activate
   
   # Linux/macOS:
   cd MaiBotç›®å½•
   source .venv/bin/activate
   
   # ç„¶åå®‰è£…æ’ä»¶ä¾èµ–
   pip install -r plugins/bilibili_video_parser/requirements.txt
   ```

3. ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… ffmpeg

4. é‡å¯ MaiBot æˆ–åœ¨ WebUI ä¸­é‡æ–°åŠ è½½æ’ä»¶ï¼Œä½¿æ’ä»¶è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶

5. ä¿®æ”¹å®Œæ’ä»¶é…ç½®æ–‡ä»¶è¯·å†æ¬¡é‡å¯maibotã€‚

---

## ä½¿ç”¨æ–¹æ³•

> âš ï¸ **æ³¨æ„**ï¼šç›®å‰ä»…æ”¯æŒ Bç«™è§†é¢‘é“¾æ¥ï¼Œ**ä¸æ”¯æŒ** QQ ä¸­åˆ†äº«çš„ Bç«™å°ç¨‹åºå¡ç‰‡ã€‚å¦‚éœ€è§£æè§†é¢‘ï¼Œè¯·å¤åˆ¶è§†é¢‘é“¾æ¥å‘é€ã€‚

### è‡ªåŠ¨æ£€æµ‹æ¨¡å¼

ç›´æ¥å‘é€ Bç«™è§†é¢‘é“¾æ¥ã€AVå·æˆ–BVå·ï¼Œéº¦éº¦ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶è§£æï¼š

```
https://www.bilibili.com/video/BV1xx411c7XZ
https://b23.tv/xxxxxx
av12345678
BV1xx411c7XZ
```

### å‘½ä»¤æ¨¡å¼

ä½¿ç”¨ `/bili` å‘½ä»¤ä¸»åŠ¨è§¦å‘è§£æï¼š

```
/bili https://www.bilibili.com/video/BV1xx411c7XZ
/bili av12345678
/bili BV1xx411c7XZ
```

---

## é…ç½®æ–‡ä»¶è¯´æ˜

é…ç½®æ–‡ä»¶ä½äºæ’ä»¶ç›®å½•ä¸‹çš„ `config.toml`ï¼Œé¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚

### [plugin] æ’ä»¶åŸºæœ¬ä¿¡æ¯

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `config_version` | string | `"3.1.0"` | é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹ |
| `enabled` | bool | `true` | æ˜¯å¦å¯ç”¨æ’ä»¶ |

### [trigger] è§¦å‘æ–¹å¼é…ç½®

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `auto_detect_enabled` | bool | `true` | æ˜¯å¦è‡ªåŠ¨æ£€æµ‹Bç«™é“¾æ¥ã€‚å¼€å¯åï¼Œç”¨æˆ·å‘é€Bç«™é“¾æ¥æ—¶ä¼šè‡ªåŠ¨è§¦å‘è§£æ |
| `command_enabled` | bool | `true` | æ˜¯å¦å¯ç”¨ `/bili` å‘½ä»¤è§¦å‘ |

### [summary] æ€»ç»“ç”Ÿæˆé…ç½®

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `enable_summary` | bool | `true` | æ˜¯å¦ç”Ÿæˆæœ€ç»ˆæ€»ç»“ã€‚å¼€å¯æ—¶ä¼šè°ƒç”¨æ¨¡å‹ç”Ÿæˆæ€»ç»“ï¼›å…³é—­æ—¶ç›´æ¥å°†åŸç”Ÿè§†é¢‘ä¿¡æ¯å‘é€ç»™å›å¤ç³»ç»Ÿ |
| `summary_max_chars` | int | `200` | æ€»ç»“æœ€å¤§å­—æ•°ã€‚èŒƒå›´ï¼š60-2000ï¼Œ**å»ºè®®ä¿æŒé»˜è®¤å€¼** |

> âš ï¸ **å…³äº summary_max_chars çš„è¯´æ˜**ï¼š
>
> å»ºè®®ä¿æŒé»˜è®¤å€¼ 200ï¼ŒåŸå› å¦‚ä¸‹ï¼š
> 1. **æ¶ˆæ¯é•¿åº¦é™åˆ¶**ï¼šMaiBot å¯¹æ¶ˆæ¯é•¿åº¦æœ‰æˆªæ–­é™åˆ¶ï¼Œæ€»ç»“è¿‡é•¿ä¼šå¯¼è‡´è§†é¢‘ä¿¡æ¯è¢«æˆªæ–­ï¼Œå½±å“å›å¤è´¨é‡
> 2. **ä¸Šä¸‹æ–‡æ•ˆç‡**ï¼šè¿‡é•¿çš„æ€»ç»“ä¼šå ç”¨æ›´å¤šçš„ä¸Šä¸‹æ–‡ç©ºé—´ï¼Œå¯èƒ½å½±å“ MaiBot çš„å›å¤ç”Ÿæˆ
> 3. **é˜…è¯»ä½“éªŒ**ï¼š200å­—å·¦å³çš„æ€»ç»“æ—¢èƒ½æ¶µç›–è§†é¢‘æ ¸å¿ƒå†…å®¹ï¼Œåˆä¸ä¼šè®©ç”¨æˆ·æ„Ÿåˆ°ä¿¡æ¯è¿‡è½½
>
> å¦‚æœç¡®å®éœ€è¦æ›´é•¿çš„æ€»ç»“ï¼Œè¯·ç¡®ä¿æ‚¨äº†è§£å¯èƒ½å¸¦æ¥çš„å½±å“ã€‚

### [video] è§†é¢‘å¤„ç†é…ç½®

ç”¨äºä»Bç«™è·å–è§†é¢‘åŸç”Ÿä¿¡æ¯ï¼ˆè§†é¢‘ä¿¡æ¯ã€å­—å¹•ã€ä¸‹è½½è§†é¢‘ç­‰ï¼‰çš„é…ç½®ã€‚

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `max_duration_min` | float | `60.0` | è§†é¢‘æœ€å¤§æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ã€‚è¶…è¿‡æ­¤æ—¶é•¿çš„è§†é¢‘å°†è¢«è·³è¿‡ä¸å¤„ç† |
| `max_size_mb` | int | `300` | è§†é¢‘æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰ã€‚è¶…è¿‡æ­¤å¤§å°çš„è§†é¢‘å°†è¢«è·³è¿‡ |
| `sessdata` | string | `""` | Bç«™SESSDATA Cookieã€‚ç”¨äºè·å–è§†é¢‘å­—å¹•ï¼Œä¸å¡«å†™æ—¶å°†è·³è¿‡å­—å¹•è·å–ã€‚<br />**ä½¿ç”¨æ­¤åŠŸèƒ½å¯èƒ½ä¼šå¯¼è‡´è´¦å·è¢«bç«™é£æ§ï¼Œè¯·ä½¿ç”¨å°å·ã€‚** |
| `enable_asr` | bool | `false` | æ˜¯å¦å¯ç”¨ASRè¯­éŸ³è¯†åˆ«ã€‚å¼€å¯åä¼šä»è§†é¢‘éŸ³è½¨ä¸­æå–è¯­éŸ³è¿›è¡Œè¯†åˆ«ï¼Œä½œä¸ºå­—å¹•çš„è¡¥å…… |
| `cache_enabled` | bool | `true` | æ˜¯å¦å¯ç”¨è§†é¢‘è§£æç»“æœç¼“å­˜ã€‚å¼€å¯åï¼Œç›¸åŒè§†é¢‘ä¸ä¼šé‡å¤è§£æ |
| `temp_file_max_age_min` | int | `60` | ä¸´æ—¶æ–‡ä»¶æœ€å¤§ä¿ç•™æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚è®¾ä¸º0è¡¨ç¤ºå¤„ç†å®Œæˆåç«‹å³åˆ é™¤ |
| `download_timeout_sec` | int | `300` | è§†é¢‘ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ç”¨äºä»Bç«™ä¸‹è½½è§†é¢‘æ–‡ä»¶ï¼Œè¶…æ—¶åé™çº§åˆ°å­—å¹•æ¨¡å¼æˆ–åŸºç¡€ä¿¡æ¯æ¨¡å¼ |
| `retry_max_attempts` | int | `3` | Bç«™APIè¯·æ±‚æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚ç”¨äºè·å–è§†é¢‘ä¿¡æ¯ã€å­—å¹•ã€ä¸‹è½½åœ°å€ç­‰Bç«™æ¥å£è°ƒç”¨ |
| `retry_interval_sec` | float | `2.0` | Bç«™APIè¯·æ±‚é‡è¯•é—´éš”ï¼ˆç§’ï¼‰ |

> ğŸ’¡ **é™çº§æœºåˆ¶è¯´æ˜**ï¼š
>
> å½“è§†é¢‘ä¸‹è½½å¤±è´¥æˆ–è¶…æ—¶æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨é™çº§å¤„ç†ï¼š
> - **Level 1ï¼ˆå®Œæ•´æ¨¡å¼ï¼‰**ï¼šè§†é¢‘ä¸‹è½½æˆåŠŸ â†’ è§†è§‰åˆ†æ + å­—å¹• â†’ è°ƒç”¨LLMç”Ÿæˆæ€»ç»“
> - **Level 2ï¼ˆå­—å¹•æ¨¡å¼ï¼‰**ï¼šè§†é¢‘ä¸‹è½½å¤±è´¥ï¼Œä½†æœ‰å­—å¹• â†’ ä»…ä½¿ç”¨å­—å¹• â†’ è°ƒç”¨LLMç”Ÿæˆæ€»ç»“
> - **Level 3ï¼ˆåŸºç¡€ä¿¡æ¯æ¨¡å¼ï¼‰**ï¼šè§†é¢‘ä¸‹è½½å¤±è´¥ï¼Œä¸”æ— å­—å¹• â†’ ä¸è°ƒç”¨LLMï¼Œç›´æ¥å‘é€è§†é¢‘åŸºç¡€ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€UPä¸»ã€æ—¶é•¿ã€ç®€ä»‹ï¼‰ç»™ä¸»å›å¤ç³»ç»Ÿ

**å¦‚ä½•è·å– SESSDATAï¼š**ä½¿ç”¨æ­¤åŠŸèƒ½è·å–è§†é¢‘å­—å¹•ï¼Œå¯èƒ½ä¼šå¯¼è‡´è´¦å·è¢«bç«™é£æ§ï¼Œè¯·ä½¿ç”¨å°å·ã€‚

1. ç™»å½• Bç«™ç½‘é¡µç‰ˆ
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ°"åº”ç”¨ç¨‹åº"ï¼ˆApplicationï¼‰æ ‡ç­¾
4. åœ¨å·¦ä¾§æ‰¾åˆ° Cookies â†’ bilibili.com
5. æ‰¾åˆ°åä¸º `SESSDATA` çš„ Cookieï¼Œå¤åˆ¶å…¶å€¼
![alt text](image.png)

### [analysis] è§†è§‰åˆ†æé…ç½®

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `visual_method` | string | `"default"` | è§†è§‰åˆ†ææ–¹å¼ï¼Œå¯é€‰å€¼è§ä¸‹è¡¨ |

**visual_method å¯é€‰å€¼ï¼š**

| å€¼ | è¯´æ˜ |
|----|------|
| `default` | ä½¿ç”¨ MaiBot ä¸»ç¨‹åºé…ç½®çš„ VLM æ¨¡å‹è¿›è¡Œå¸§åˆ†æï¼ˆæ¨èï¼‰ |
| `builtin` | ä½¿ç”¨æ’ä»¶å†…ç½®çš„ VLM é…ç½®ï¼Œéœ€è¦åœ¨ `[analysis.builtin]` ä¸­é…ç½® API |
| `doubao` | ä½¿ç”¨è±†åŒ…è§†é¢‘ç†è§£æ¨¡å‹ï¼Œéœ€è¦åœ¨ `[analysis.doubao]` ä¸­é…ç½® API |
| `none` | ä¸è¿›è¡Œè§†è§‰åˆ†æï¼Œä»…ä½¿ç”¨å­—å¹•å’Œè§†é¢‘ä¿¡æ¯ |

### [analysis.default] Defaultæ¨¡å¼é…ç½®

ä½¿ç”¨ MaiBot ä¸»ç¨‹åºçš„ VLM æ¨¡å‹æ—¶çš„é…ç½®ã€‚

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `visual_max_duration_min` | float | `10.0` | è¿›è¡Œè§†è§‰åˆ†æçš„æœ€å¤§è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ã€‚è¶…è¿‡æ­¤æ—¶é•¿çš„è§†é¢‘å°†åªä½¿ç”¨å­—å¹•+ASRï¼Œä¸è¿›è¡Œè§†è§‰åˆ†æï¼ˆèŠ‚çœAPIè´¹ç”¨ï¼‰ |
| `frame_interval_sec` | int | `10` | æŠ½å¸§é—´éš”ï¼ˆç§’ï¼‰ã€‚æ¯éš”å¤šå°‘ç§’æŠ½å–ä¸€å¸§ï¼Œç³»ç»Ÿä¼šæ ¹æ®è§†é¢‘æ—¶é•¿å’Œæ­¤é—´éš”è‡ªåŠ¨è®¡ç®—æŠ½å¸§æ•°é‡ï¼ˆæœ€å¤š10å¸§ï¼Œæœ€å¤šåˆ†æ5å¸§ï¼‰ |
| `frame_prompt` | string | `""` | è‡ªå®šä¹‰å¸§åˆ†ææç¤ºè¯ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤æç¤ºè¯ |

> âš ï¸ **å…³äº frame_prompt çš„è¯´æ˜**ï¼š
>
> - **é»˜è®¤æç¤ºè¯**ï¼šè¦æ±‚VLMè¿”å›å°‘äº25å­—çš„ç®€çŸ­æè¿°
> - **è‡ªå®šä¹‰æç¤ºè¯**ï¼šæ‚¨å¯ä»¥åœ¨æç¤ºè¯ä¸­æŒ‡å®šè¿”å›å­—æ•°ï¼Œå¦‚"è¯·ç”¨100å­—æè¿°..."
> - **çº¦æŸè‡ªåŠ¨è¿½åŠ **ï¼šæ— è®ºæ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨æœ«å°¾è‡ªåŠ¨è¿½åŠ çº¦æŸï¼š"ä»…æè¿°ç”»é¢ä¸­å®é™…å‡ºç°çš„å†…å®¹ï¼Œä¸è¦æ¨æµ‹æˆ–ç¼–é€ ã€‚è‹¥æ— æ³•åˆ¤æ–­ï¼Œè¯·å›ç­”'æœªè¯†åˆ«'ã€‚"
> - **å»ºè®®**ï¼šä¸å»ºè®®è®¾ç½®è¿‡é•¿çš„å¸§æè¿°ï¼Œå› ä¸ºæ¯å¸§æè¿°éƒ½ä¼šå ç”¨ä¸Šä¸‹æ–‡ç©ºé—´ï¼Œå½±å“æœ€ç»ˆæ€»ç»“è´¨é‡

### [analysis.builtin] Builtinæ¨¡å¼é…ç½®

ä½¿ç”¨æ’ä»¶å†…ç½® VLM æ—¶çš„é…ç½®ã€‚éœ€è¦è‡ªè¡Œé…ç½® APIã€‚æ”¯æŒåŠ¨æ€å‚æ•°ä¼ é€’ï¼Œå¯æ ¹æ®ä¸åŒAPIæœåŠ¡å•†æ·»åŠ è‡ªå®šä¹‰å‚æ•°ã€‚

> ğŸ’¡ **æ³¨æ„**ï¼šæ­¤èŠ‚çš„è¶…æ—¶å’Œé‡è¯•é…ç½®ç”¨äº VLM API è¯·æ±‚ï¼ˆå¸§å›¾ç‰‡åˆ†æï¼‰ï¼Œä¸ `[video]` èŠ‚çš„ Bç«™API é…ç½®æ˜¯ç‹¬ç«‹çš„ã€‚

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `visual_max_duration_min` | float | `10.0` | è¿›è¡Œè§†è§‰åˆ†æçš„æœ€å¤§è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| `frame_interval_sec` | int | `10` | æŠ½å¸§é—´éš”ï¼ˆç§’ï¼‰ï¼Œç³»ç»Ÿä¼šæ ¹æ®è§†é¢‘æ—¶é•¿å’Œæ­¤é—´éš”è‡ªåŠ¨è®¡ç®—æŠ½å¸§æ•°é‡ï¼ˆæœ€å¤š10å¸§ï¼Œæœ€å¤šåˆ†æ5å¸§ï¼‰ |
| `client_type` | string | `"openai"` | APIæœåŠ¡ç±»å‹ï¼š`openai`ï¼ˆå…¼å®¹OpenAIæ ¼å¼çš„APIï¼‰æˆ– `gemini`ï¼ˆGoogle Geminiæ ¼å¼ï¼‰ |
| `base_url` | string | `"https://api.siliconflow.cn/v1"` | APIåŸºç¡€URL |
| `api_key` | string | `""` | APIå¯†é’¥ |
| `model` | string | `"Qwen/Qwen2.5-VL-72B-Instruct"` | æ¨¡å‹æ ‡è¯†ç¬¦ï¼ˆAPIæœåŠ¡å•†æä¾›çš„æ¨¡å‹IDï¼‰ |
| `timeout` | int | `60` | VLM APIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ç”¨äºå¸§å›¾ç‰‡åˆ†æè¯·æ±‚ |
| `max_retries` | int | `2` | VLM APIè¯·æ±‚æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚ç”¨äºå¸§å›¾ç‰‡åˆ†æå¤±è´¥åçš„é‡è¯• |
| `retry_interval` | int | `5` | VLM APIè¯·æ±‚é‡è¯•é—´éš”ï¼ˆç§’ï¼‰ |
| `frame_prompt` | string | `""` | è‡ªå®šä¹‰å¸§åˆ†ææç¤ºè¯ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤æç¤ºè¯ |

**åŠ¨æ€å‚æ•°è¯´æ˜**ï¼šbuiltinæ¨¡å¼æ”¯æŒåŠ¨æ€å‚æ•°ä¼ é€’ï¼Œæ‚¨å¯ä»¥æ ¹æ®APIæœåŠ¡å•†çš„è¦æ±‚æ·»åŠ é¢å¤–å‚æ•°ï¼Œå¦‚ `temperature`ã€`max_tokens`ã€`top_p` ç­‰ã€‚åªæœ‰æ‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­å®é™…å®šä¹‰çš„å‚æ•°æ‰ä¼šè¢«ä¼ é€’ç»™APIã€‚

> âš ï¸ **å…³äº frame_prompt çš„è¯´æ˜**ï¼š
>
> - **é»˜è®¤æç¤ºè¯**ï¼šè¦æ±‚VLMè¿”å›å°‘äº25å­—çš„ç®€çŸ­æè¿°
> - **è‡ªå®šä¹‰æç¤ºè¯**ï¼šæ‚¨å¯ä»¥åœ¨æç¤ºè¯ä¸­æŒ‡å®šè¿”å›å­—æ•°ï¼Œå¦‚"è¯·ç”¨100å­—æè¿°..."
> - **çº¦æŸè‡ªåŠ¨è¿½åŠ **ï¼šæ— è®ºæ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨æœ«å°¾è‡ªåŠ¨è¿½åŠ çº¦æŸï¼š"ä»…æè¿°ç”»é¢ä¸­å®é™…å‡ºç°çš„å†…å®¹ï¼Œä¸è¦æ¨æµ‹æˆ–ç¼–é€ ã€‚è‹¥æ— æ³•åˆ¤æ–­ï¼Œè¯·å›ç­”'æœªè¯†åˆ«'ã€‚"
> - **å»ºè®®**ï¼šä¸å»ºè®®è®¾ç½®è¿‡é•¿çš„å¸§æè¿°ï¼Œå› ä¸ºæ¯å¸§æè¿°éƒ½ä¼šå ç”¨ä¸Šä¸‹æ–‡ç©ºé—´ï¼Œå½±å“æœ€ç»ˆæ€»ç»“è´¨é‡

### [analysis.doubao] Doubaoæ¨¡å¼é…ç½®

ä½¿ç”¨è±†åŒ…è§†é¢‘ç†è§£æ¨¡å‹æ—¶çš„é…ç½®ã€‚æ”¯æŒåŠ¨æ€å‚æ•°ä¼ é€’ã€‚

> ğŸ’¡ **æ³¨æ„**ï¼šæ­¤èŠ‚çš„è¶…æ—¶å’Œé‡è¯•é…ç½®ç”¨äºè±†åŒ… API è¯·æ±‚ï¼ˆè§†é¢‘ä¸Šä¼ å’Œåˆ†æï¼‰ï¼Œä¸ `[video]` èŠ‚çš„ Bç«™API é…ç½®æ˜¯ç‹¬ç«‹çš„ã€‚è±†åŒ…éœ€è¦ä¸Šä¼ è§†é¢‘å¹¶ç­‰å¾…åˆ†æç»“æœï¼Œå»ºè®®è®¾ç½®è¾ƒé•¿çš„è¶…æ—¶æ—¶é—´ã€‚

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `visual_max_duration_min` | float | `10.0` | è¿›è¡Œè§†è§‰åˆ†æçš„æœ€å¤§è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| `api_key` | string | `""` | è±†åŒ…APIå¯†é’¥ï¼Œä¹Ÿå¯é€šè¿‡ç¯å¢ƒå˜é‡ `ARK_API_KEY` è®¾ç½® |
| `model_id` | string | `"doubao-seed-1-6-flash-250828"` | è±†åŒ…æ¨¡å‹ID |
| `fps` | float | `1.0` | æŠ½å¸§é¢‘ç‡ï¼ˆ0.2-5ï¼‰ï¼Œå€¼è¶Šé«˜ç†è§£è¶Šç²¾ç»†ä½†tokenæ¶ˆè€—è¶Šå¤§ |
| `base_url` | string | `"https://ark.cn-beijing.volces.com/api/v3"` | è±†åŒ…APIåŸºç¡€URL |
| `timeout` | int | `120` | è±†åŒ…APIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ã€‚åŒ…å«è§†é¢‘ä¸Šä¼ å’Œåˆ†æè¿”å›çš„æ€»æ—¶é—´ï¼Œå»ºè®®è®¾ç½®è¾ƒé•¿ |
| `max_retries` | int | `2` | è±†åŒ…APIè¯·æ±‚æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚ç”¨äºè§†é¢‘åˆ†æå¤±è´¥åçš„é‡è¯• |
| `retry_interval` | int | `10` | è±†åŒ…APIè¯·æ±‚é‡è¯•é—´éš”ï¼ˆç§’ï¼‰ã€‚è±†åŒ…æœåŠ¡å¯èƒ½éœ€è¦è¾ƒé•¿æ¢å¤æ—¶é—´ï¼Œå»ºè®®è®¾ç½®è¾ƒé•¿ |
| `summary_min_chars` | int | `100` | è±†åŒ…è§†é¢‘åˆ†ææœ€å°å­—æ•° |
| `summary_max_chars` | int | `150` | è±†åŒ…è§†é¢‘åˆ†ææœ€å¤§å­—æ•° |
| `video_prompt` | string | `""` | è‡ªå®šä¹‰è§†é¢‘åˆ†ææç¤ºè¯ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤æç¤ºè¯ã€‚æç¤ºè¯ä¸­å¯ä½¿ç”¨ `{summary_min_chars}` å’Œ `{summary_max_chars}` å ä½ç¬¦ |

**åŠ¨æ€å‚æ•°è¯´æ˜**ï¼šdoubaoæ¨¡å¼åŒæ ·æ”¯æŒåŠ¨æ€å‚æ•°ä¼ é€’ï¼Œæ‚¨å¯ä»¥æ·»åŠ è±†åŒ…APIæ”¯æŒçš„é¢å¤–å‚æ•°ã€‚

---

## é…ç½®ç¤ºä¾‹

### æœ€ç®€é…ç½®ï¼ˆä½¿ç”¨MaiBotçš„VLMï¼‰

```toml
[plugin]
enabled = true

[trigger]
auto_detect_enabled = true
command_enabled = true

[summary]
enable_summary = true
summary_max_chars = 200

[video]
sessdata = "ä½ çš„SESSDATA"

[analysis]
visual_method = "default"
```

### ä½¿ç”¨æ’ä»¶å†…ç½®VLMï¼ˆç¡…åŸºæµåŠ¨ï¼‰

```toml
[plugin]
enabled = true

[summary]
enable_summary = true
summary_max_chars = 200

[video]
sessdata = "ä½ çš„SESSDATA"

[analysis]
visual_method = "builtin"

[analysis.builtin]
client_type = "openai"
base_url = "https://api.siliconflow.cn/v1"
api_key = "ä½ çš„APIå¯†é’¥"
model = "Qwen/Qwen2.5-VL-72B-Instruct"
```

### ä½¿ç”¨è±†åŒ…è§†é¢‘æ¨¡å‹

```toml
[plugin]
enabled = true

[summary]
enable_summary = true
summary_max_chars = 200

[video]
sessdata = "ä½ çš„SESSDATA"

[analysis]
visual_method = "doubao"

[analysis.doubao]
api_key = "ä½ çš„è±†åŒ…APIå¯†é’¥"
model_id = "doubao-seed-1-6-flash-250828"
```

---

## æ•…éšœæ’æŸ¥

### ffmpeg æœªæ‰¾åˆ°

**ç—‡çŠ¶**ï¼šæ’ä»¶åŠ è½½æ—¶æç¤º "ffmpegä¸å¯ç”¨ï¼Œè§†é¢‘è§£æåŠŸèƒ½å°†å—é™"

**è§£å†³æ–¹æ³•**ï¼š
1. åœ¨ç»ˆç«¯è¿è¡Œ `ffmpeg -version` ç¡®è®¤å®‰è£…æˆåŠŸ
2. å¦‚æœå‘½ä»¤ä¸å­˜åœ¨ï¼Œè¯·æŒ‰ç…§ä¸Šè¿°å®‰è£…æ–¹æ³•å®‰è£… ffmpeg
3. Windows ç”¨æˆ·å®‰è£…åéœ€è¦é‡å¯ç»ˆç«¯æˆ–ç”µè„‘
4. æ‰‹åŠ¨å®‰è£…çš„ç”¨æˆ·è¯·ç¡®è®¤ bin ç›®å½•å·²æ·»åŠ åˆ° PATH

### è§†é¢‘ä¸‹è½½å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- è§†é¢‘éœ€è¦Bç«™ç™»å½•æ‰èƒ½è§‚çœ‹ï¼ˆé…ç½® SESSDATA å¯è§£å†³éƒ¨åˆ†æƒ…å†µï¼‰
- è§†é¢‘æœ‰åœ°åŒºé™åˆ¶
- ç½‘ç»œè¿æ¥é—®é¢˜

### å­—å¹•è·å–å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æœªé…ç½® SESSDATA
- SESSDATA å·²è¿‡æœŸï¼ˆéœ€è¦é‡æ–°è·å–ï¼‰
- è§†é¢‘æœ¬èº«æ²¡æœ‰å­—å¹•

### è§†è§‰åˆ†æå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- VLM API é…ç½®é”™è¯¯
- API å¯†é’¥æ— æ•ˆæˆ–ä½™é¢ä¸è¶³
- ç½‘ç»œè¿æ¥é—®é¢˜

---



---

## å¼€æºåè®®

æœ¬æ’ä»¶é‡‡ç”¨ **GNU Affero General Public License v3.0 (AGPL-3.0)** åè®®å¼€æºã€‚

```
Copyright (C) 2024

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
```

å®Œæ•´åè®®æ–‡æœ¬è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚